{{ define "main" }}
<div class="container max-w-6xl mx-auto px-4 pt-24 pb-16">
    <div class="flex gap-16">
        <!-- 文章主体内容 -->
        <div class="relative">
            <div class="flex gap-8 max-w-6xl mx-auto px-4 py-12 md:py-20">
                <div class="w-full lg:max-w-3xl">
                    <!-- 文章头部 -->
                    <header class="mb-12">
                        <h1 class="text-4xl font-bold mb-6">{{ .Title }}</h1>
                    </header>

                    <!-- AI 摘要 -->
                    {{ partial "components/ai-summary.html" . }}

                    <!-- 文章内容 -->
                    <article class="prose prose-neutral dark:prose-invert max-w-none">
                        {{ .Content }}
                    </article>

                    <!-- 系列文章导航 -->
                    {{ partial "components/series-nav.html" . }}

                    <!-- 版权信息 -->
                    {{ partial "components/copyright.html" . }}

                    <!-- 评论区 -->
                    {{ partial "components/comments.html" . }}
                </div>

                <!-- 侧边栏 -->
                <div class="hidden lg:block w-64 flex-shrink-0">
                    <div class="sticky top-24 flex flex-col gap-6">
                        {{ partial "components/toc.html" . }}
                        {{ partial "components/reading-progress.html" . }}
                    </div>
                </div>
            </div>

            <!-- 阅读进度指示器 -->
            <div id="reading-progress-ball" class="lg:hidden fixed right-4 bottom-20 w-12 h-12 rounded-full 
                bg-card/95 dark:bg-card-dark/95 backdrop-blur 
                shadow-lg border border-border/20 dark:border-border-dark/20
                flex items-center justify-center text-sm font-medium tabular-nums
                transition-all duration-300 transform translate-y-24 opacity-0">
                0%
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const progressBall = document.getElementById('reading-progress-ball');
        const article = document.querySelector('article');

        function updateReadingProgress() {
            const rect = article.getBoundingClientRect();
            const windowHeight = window.innerHeight;
            const articleHeight = article.offsetHeight;

            // 计算阅读进度百分比
            let progress = (windowHeight - rect.top) / (articleHeight - windowHeight) * 100;
            progress = Math.min(100, Math.max(0, progress));

            // 更新移动端进度球
            if (progressBall) {
                progressBall.textContent = `${Math.round(progress)}%`;

                // 控制进度球的显示/隐藏
                if (progress > 0 && progress < 100) {
                    progressBall.classList.remove('translate-y-24', 'opacity-0');
                } else {
                    progressBall.classList.add('translate-y-24', 'opacity-0');
                }
            }
        }

        window.addEventListener('scroll', updateReadingProgress);
        updateReadingProgress();
    });
</script>
{{ end }}